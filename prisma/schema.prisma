// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  permissions Json?    // Array de permisos como JSON
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model User {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  password       String
  firstName      String
  middleName     String?
  lastName       String
  secondLastName String?
  phoneNumber    String?
  profileImage   String?  // You can store a URL or path here
  typeUser       String   // Tipo de usuario
  roleId         Int
  role           Role     @relation(fields: [roleId], references: [id])

  parentId       Int?
  parent         User?    @relation("UserToSubUsers", fields: [parentId], references: [id])
  subUsers       User[]   @relation("UserToSubUsers")

  // Relaciones con otros modelos
  yachts         Yacht[]
  yachtCategories YachtCategory[]
  tours          Tour[]
  tourCategories TourCategory[]
  clubs          Club[]
  clubTypes      ClubType[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model YachtCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  yachts    Yacht[]
  userId    Int      // ID del usuario que creó esta categoría
  user      User     @relation(fields: [userId], references: [id])
  
  // Campos de ubicación
  stateId         Int
  state           State      @relation(fields: [stateId], references: [id], onDelete: Cascade)
  municipalityId  Int
  municipality    Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  localityId      Int
  locality        Locality   @relation(fields: [localityId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Yacht {
  id              Int        @id @default(autoincrement())
  name            String
  capacity        Int        // Number of people
  length          String     // Length in meters
  location        String     // Port location
  description     String     @db.Text
  features        String?    @db.Text // Features and equipment
  pricing         Json?      // Array of objects with hora and precios properties
  status          String     @default("Activo") // Status: "Activo" or "Inactivo"
  yachtCategoryId Int
  yachtCategory   YachtCategory  @relation(fields: [yachtCategoryId], references: [id])
  userId          Int        // ID del usuario que creó este yate
  user            User       @relation(fields: [userId], references: [id])
  
  // Campos de ubicación
  stateId         Int
  state           State      @relation(fields: [stateId], references: [id], onDelete: Cascade)
  municipalityId  Int
  municipality    Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  localityId      Int
  locality        Locality   @relation(fields: [localityId], references: [id], onDelete: Cascade)
  
  images          YachtImage[]
  characteristics YachtCharacteristic[]
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

model YachtImage {
  id        Int      @id @default(autoincrement())
  url       String   // URL of the image
  yachtId   Int
  yacht     Yacht    @relation(fields: [yachtId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model YachtCharacteristic {
  id        Int      @id @default(autoincrement())
  name      String   // Characteristic name in English
  yachtId   Int
  yacht     Yacht    @relation(fields: [yachtId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TourCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  tours     Tour[]
  userId    Int      // ID del usuario que creó esta categoría
  user      User     @relation(fields: [userId], references: [id])
  
  // Campos de ubicación
  stateId         Int
  state           State      @relation(fields: [stateId], references: [id], onDelete: Cascade)
  municipalityId  Int
  municipality    Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  localityId      Int
  locality        Locality   @relation(fields: [localityId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
 
model Tour {
  id            Int        @id @default(autoincrement())
  name          String     // Tour name (e.g., "Tour Isla Mujeres")
  description   String     @db.Text // Tour description
  pricing       Json?      // Array of objects with personas and precio properties
  location      String     // Location (e.g., "Cancún")
  status        String     @default("Activo") // Status: "Activo" or "Inactivo"
  
  // Nuevos campos para tours
  horarios      String?    // Horarios: "De lunes a sábado. A las 09:00, 11:00, 13:00 y 15:00 horas."
  duracion      String?    // Duración: "105 minutos"
  edadMinima    String?    // Edad mínima: "A partir de los 12 años"
  transportacion String?   // Opciones de transportación: "Rutas desde el hotel Dreams Natura Resort & Spa hasta el Riu Dunamar y centro de Cancún."
  
  tourCategoryId Int
  tourCategory   TourCategory   @relation(fields: [tourCategoryId], references: [id])
  userId         Int            // ID del usuario que creó este tour
  user           User           @relation(fields: [userId], references: [id])
  
  // Campos de ubicación
  stateId        Int
  state          State     @relation(fields: [stateId], references: [id], onDelete: Cascade)
  municipalityId Int
  municipality   Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  localityId     Int
  locality       Locality  @relation(fields: [localityId], references: [id], onDelete: Cascade)
  
  images        TourImage[]
  characteristics TourCharacteristic[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model TourCharacteristic {
  id        Int      @id @default(autoincrement())
  name      String   // Characteristic name in English
  tourId    Int
  tour      Tour     @relation(fields: [tourId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TourImage {
  id        Int      @id @default(autoincrement())
  url       String   // URL of the image
  tourId    Int
  tour      Tour     @relation(fields: [tourId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model State {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  municipalities Municipality[]
  clubs         Club[]
  yachts        Yacht[]       // Yates en este estado
  tours         Tour[]        // Tours en este estado
  yachtCategories YachtCategory[] // Categorías de yates en este estado
  tourCategories TourCategory[]   // Categorías de tours en este estado
  clubTypes     ClubType[]    // Tipos de clubs en este estado
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Municipality {
  id          Int        @id @default(autoincrement())
  name        String
  stateId     Int
  state       State      @relation(fields: [stateId], references: [id], onDelete: Cascade)
  localities  Locality[]
  clubs       Club[]
  yachts      Yacht[]    // Yates en este municipio
  tours       Tour[]     // Tours en este municipio
  yachtCategories YachtCategory[] // Categorías de yates en este municipio
  tourCategories TourCategory[]   // Categorías de tours en este municipio
  clubTypes   ClubType[] // Tipos de clubs en este municipio
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Locality {
  id             Int          @id @default(autoincrement())
  name           String
  municipalityId Int
  municipality   Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  clubs          Club[]
  yachts         Yacht[]      // Yates en esta localidad
  tours          Tour[]       // Tours en esta localidad
  yachtCategories YachtCategory[] // Categorías de yates en esta localidad
  tourCategories TourCategory[]   // Categorías de tours en esta localidad
  clubTypes      ClubType[]   // Tipos de clubs en esta localidad
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}






model Club {
  id             Int        @id @default(autoincrement())
  name           String
  description    String?
  address        String?
  typeId         Int
  type           ClubType   @relation(fields: [typeId], references: [id], onDelete: Cascade)
  
  stateId        Int
  state          State      @relation(fields: [stateId], references: [id], onDelete: Cascade)

  municipalityId Int
  municipality   Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)

  localityId     Int
  locality       Locality   @relation(fields: [localityId], references: [id], onDelete: Cascade)

  userId         Int        // ID del usuario que creó este club
  user           User       @relation(fields: [userId], references: [id])

  images         ClubImage[]
  characteristics ClubCharacteristic[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model ClubImage {
  id        Int      @id @default(autoincrement())
  url       String   // URL of the image
  clubId    Int
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClubCharacteristic {
  id        Int      @id @default(autoincrement())
  name      String   // Characteristic name in English
  clubId    Int
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClubType {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  clubs     Club[]
  userId    Int      // ID del usuario que creó este tipo de club
  user      User     @relation(fields: [userId], references: [id])
  
  // Campos de ubicación
  stateId         Int
  state           State      @relation(fields: [stateId], references: [id], onDelete: Cascade)
  municipalityId  Int
  municipality    Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)
  localityId      Int
  locality        Locality   @relation(fields: [localityId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
